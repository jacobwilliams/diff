<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   <meta name="description" content="Numerical Differentiation of a User Defined Function">
    <meta name="author" content="Jacob Williams" >
    <link rel="icon" href="../favicon.png">

    <title>diff &ndash; diff</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">diff </a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
            <li><a href="../sourcefile/diff_module.f90.html">Source File</a></li>
            <li><a href="../lists/modules.html">Modules</a></li>
            <li><a href="../lists/procedures.html">Procedures</a></li>
            <li><a href="../lists/absint.html">Abstract Interfaces</a></li>
                   <li><a href="../lists/types.html">Derived Types</a></li>
       
            </ul>
        
            </li>
<li class="visible-xs hidden-sm visible-lg"><a href="../sourcefile/diff_module.f90.html">Source File</a></li>
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/absint.html">Abstract Interfaces</a></li>
                             <li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>
          </ul>
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
  <div class="row">
    <h1>diff
      <small>Subroutine</small>
    </h1>
    <div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
    data-placement="bottom" data-html="true"
    title="88.2% of total for procedures.">525 statements</a>
     </li> 
    <li><i class="fa fa-code"></i><a href="../src/diff_module.f90"> Source File</a></li>
  </ul>
  <ol class="breadcrumb in-well text-right">
     <li><a href='../sourcefile/diff_module.f90.html'>diff_module.f90</a></li>
     <li><a href='../module/diff_module.html'>diff_module</a></li>
     <li class="active">diff</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    <div id="sidebar">
  <h3>Contents</h3>
 
<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../proc/diff.html#src">diff</a>
  </div>
</div>

</div>

    </div>
    
    <div class="col-md-9" id='text'>
    <h2>private subroutine diff(me, iord, x0, xmin, xmax, eps, accr, deriv, error, ifail)</h2>
    

    <p>the procedure diff calculates the first, second or
  third order derivative of a function by using neville's process to
  extrapolate from a sequence of simple polynomial approximations based on
  interpolating points distributed symmetrically about x0 (or lying only on
  one side of x0 should this be necessary).  if the specified tolerance is
  non-zero then the procedure attempts to satisfy this absolute or relative
  accuracy requirement, while if it is unsuccessful or if the tolerance is
  set to zero then the result having the minimum achievable estimated error
  is returned instead.</p>
<h2>Authors</h2>
<ul>
<li>Original code from <a href="ftp://math.nist.gov/pub/repository/diff/src/DIFF">NIST</a></li>
<li>Jacob Williams : 2/17/2013 :
     Converted to modern Fortran.
     Some refactoring, addition of test cases.</li>
</ul>

    <h3>Arguments</h3>
      <table class="table table-striped varlist">
<thead><tr><th>Type</th><th>Intent</th><th>Optional</th><th>Attributes</th><th></th><th>Name</th><th></th></thead>
<tbody>
<tr>
  <td><span class="anchor" id="variable-me~3"></span>class(<a href='../type/diff_func.html'>diff_func</a>),</td>
<td>intent(inout)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>me</strong></td><td></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-iord"></span>integer,</td>
<td>intent(in)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>iord</strong></td><td><p>1, 2 or 3 specifies that the first, second or third order
derivative,respectively, is required.</p></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-x0"></span>real(kind=wp),</td>
<td>intent(in)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>x0</strong></td><td><p>the point at which the derivative of the function is to be calculated.</p></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-xmin"></span>real(kind=wp),</td>
<td>intent(in)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>xmin</strong></td><td><p>xmin, xmax restrict the interpolating points to lie in [xmin, xmax], which
should be the largest interval including x0 in which the function is
calculable and continuous.</p></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-xmax"></span>real(kind=wp),</td>
<td>intent(in)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>xmax</strong></td><td><p>xmin, xmax restrict the interpolating points to lie in [xmin, xmax], which
should be the largest interval including x0 in which the function is
calculable and continuous.</p></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-eps"></span>real(kind=wp),</td>
<td>intent(in)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>eps</strong></td><td><p>denotes the tolerance, either absolute or relative.  eps=0 specifies that
the error is to be minimised, while eps&gt;0 or eps&lt;0 specifies that the
absolute or relative error, respectively, must not exceed abs(eps) if
possible.  the accuracy requirement should not be made stricter than
necessary, since the amount of computation tends to increase as
the magnitude of eps decreases, and is particularly high when eps=0.</p></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-accr"></span>real(kind=wp),</td>
<td>intent(in)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>accr</strong></td><td><p>denotes that the absolute (accr&gt;0) or relative (accr&lt;0) errors in the
computed values of the function are most unlikely to exceed abs(accr), which
should be as small as possible.  if the user cannot estimate accr with
complete confidence, then it should be set to zero.</p></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-deriv"></span>real(kind=wp),</td>
<td>intent(out)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>deriv</strong></td><td><p>the calculated value of the derivative</p></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-error"></span>real(kind=wp),</td>
<td>intent(out)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>error</strong></td><td><p>an estimated upper bound on the magnitude of the absolute error in
the calculated result.  it should always be examined, since in extreme case
may indicate that there are no correct significant digits in the value
returned for derivative.</p></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-ifail"></span>integer,</td>
<td>intent(out)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>ifail</strong></td><td><p>will have one of the following values on exit:
 <em>0</em> the procedure was successful.
 <em>1</em> the estimated error in the result exceeds the (non-zero) requested
     error, but the most accurate result possible has been returned.
 <em>2</em> input data incorrect (derivative and error will be undefined).
 <em>3</em> the interval [xmin, xmax] is too small (derivative and error will be
     undefined).</p></td>
</tr>
</tbody>
</table>

    <br>

    <section class="visible-xs visible-sm hidden-md">
      <h3>Contents</h3>
 
<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../proc/diff.html#src">diff</a>
  </div>
</div>

    </section>
    <br class="visible-xs visible-sm hidden-md">


    
    

    
    


    
    <section>
    <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="highlight"><pre><span></span><span class="w">    </span><span class="k">subroutine </span><span class="n">diff</span><span class="p">(</span><span class="n">me</span><span class="p">,</span><span class="n">iord</span><span class="p">,</span><span class="n">x0</span><span class="p">,</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span><span class="n">eps</span><span class="p">,</span><span class="n">accr</span><span class="p">,</span><span class="n">deriv</span><span class="p">,</span><span class="n">error</span><span class="p">,</span><span class="n">ifail</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="k">implicit none</span>

<span class="k">    class</span><span class="p">(</span><span class="n">diff_func</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">me</span><span class="w"></span>
<span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w">    </span><span class="kd">::</span><span class="w"> </span><span class="n">iord</span><span class="w">   </span><span class="c">!! 1, 2 or 3 specifies that the first, second or third order</span>
<span class="w">                                    </span><span class="c">!! derivative,respectively, is required.</span>
<span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">x0</span><span class="w">     </span><span class="c">!! the point at which the derivative of the function is to be calculated.</span>
<span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">xmin</span><span class="w">   </span><span class="c">!! xmin, xmax restrict the interpolating points to lie in [xmin, xmax], which</span>
<span class="w">                                    </span><span class="c">!! should be the largest interval including x0 in which the function is</span>
<span class="w">                                    </span><span class="c">!! calculable and continuous.</span>
<span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">xmax</span><span class="w">   </span><span class="c">!! xmin, xmax restrict the interpolating points to lie in [xmin, xmax], which</span>
<span class="w">                                    </span><span class="c">!! should be the largest interval including x0 in which the function is</span>
<span class="w">                                    </span><span class="c">!! calculable and continuous.</span>
<span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">eps</span><span class="w">    </span><span class="c">!! denotes the tolerance, either absolute or relative.  eps=0 specifies that</span>
<span class="w">                                    </span><span class="c">!! the error is to be minimised, while eps&gt;0 or eps&lt;0 specifies that the</span>
<span class="w">                                    </span><span class="c">!! absolute or relative error, respectively, must not exceed abs(eps) if</span>
<span class="w">                                    </span><span class="c">!! possible.  the accuracy requirement should not be made stricter than</span>
<span class="w">                                    </span><span class="c">!! necessary, since the amount of computation tends to increase as</span>
<span class="w">                                    </span><span class="c">!! the magnitude of eps decreases, and is particularly high when eps=0.</span>
<span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">accr</span><span class="w">   </span><span class="c">!! denotes that the absolute (accr&gt;0) or relative (accr&lt;0) errors in the</span>
<span class="w">                                    </span><span class="c">!! computed values of the function are most unlikely to exceed abs(accr), which</span>
<span class="w">                                    </span><span class="c">!! should be as small as possible.  if the user cannot estimate accr with</span>
<span class="w">                                    </span><span class="c">!! complete confidence, then it should be set to zero.</span>
<span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">deriv</span><span class="w">  </span><span class="c">!! the calculated value of the derivative</span>
<span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">error</span><span class="w">  </span><span class="c">!! an estimated upper bound on the magnitude of the absolute error in</span>
<span class="w">                                    </span><span class="c">!! the calculated result.  it should always be examined, since in extreme case</span>
<span class="w">                                    </span><span class="c">!! may indicate that there are no correct significant digits in the value</span>
<span class="w">                                    </span><span class="c">!! returned for derivative.</span>
<span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">ifail</span><span class="w">  </span><span class="c">!! will have one of the following values on exit:</span>
<span class="w">                                    </span><span class="c">!!  *0* the procedure was successful.</span>
<span class="w">                                    </span><span class="c">!!  *1* the estimated error in the result exceeds the (non-zero) requested</span>
<span class="w">                                    </span><span class="c">!!      error, but the most accurate result possible has been returned.</span>
<span class="w">                                    </span><span class="c">!!  *2* input data incorrect (derivative and error will be undefined).</span>
<span class="w">                                    </span><span class="c">!!  *3* the interval [xmin, xmax] is too small (derivative and error will be</span>
<span class="w">                                    </span><span class="c">!!      undefined).</span>

<span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">acc</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">beta4</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">h0</span><span class="p">,</span><span class="n">h1</span><span class="p">,</span><span class="n">h2</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">        </span><span class="n">newh1</span><span class="p">,</span><span class="n">newh2</span><span class="p">,</span><span class="n">heval</span><span class="p">,</span><span class="n">hprev</span><span class="p">,</span><span class="n">baseh</span><span class="p">,</span><span class="n">hacc1</span><span class="p">,</span><span class="n">hacc2</span><span class="p">,</span><span class="n">nhacc1</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">        </span><span class="n">nhacc2</span><span class="p">,</span><span class="n">minh</span><span class="p">,</span><span class="n">maxh</span><span class="p">,</span><span class="n">maxh1</span><span class="p">,</span><span class="n">maxh2</span><span class="p">,</span><span class="n">tderiv</span><span class="p">,</span><span class="n">f0</span><span class="p">,</span><span class="n">twof0</span><span class="p">,</span><span class="n">f1</span><span class="p">,</span><span class="n">f2</span><span class="p">,</span><span class="n">f3</span><span class="p">,</span><span class="n">f4</span><span class="p">,</span><span class="n">fmax</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">        </span><span class="n">maxfun</span><span class="p">,</span><span class="n">pmaxf</span><span class="p">,</span><span class="n">df1</span><span class="p">,</span><span class="n">deltaf</span><span class="p">,</span><span class="n">pdelta</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">zpower</span><span class="p">,</span><span class="n">c0f0</span><span class="p">,</span><span class="n">c1</span><span class="p">,</span><span class="n">c2</span><span class="p">,</span><span class="n">c3</span><span class="p">,</span><span class="n">dnew</span><span class="p">,</span><span class="n">dprev</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">        </span><span class="n">re</span><span class="p">,</span><span class="n">te</span><span class="p">,</span><span class="n">newerr</span><span class="p">,</span><span class="n">temerr</span><span class="p">,</span><span class="n">newacc</span><span class="p">,</span><span class="n">pacc1</span><span class="p">,</span><span class="n">pacc2</span><span class="p">,</span><span class="n">facc1</span><span class="p">,</span><span class="n">facc2</span><span class="p">,</span><span class="n">acc0</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">        </span><span class="n">acc1</span><span class="p">,</span><span class="n">acc2</span><span class="p">,</span><span class="n">relacc</span><span class="p">,</span><span class="n">twoinf</span><span class="p">,</span><span class="n">twosup</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">        </span><span class="n">d</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">denom</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">e</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">minerr</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">maxf</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">),</span><span class="k">save</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="mi">13</span><span class="p">),</span><span class="n">storef</span><span class="p">(</span><span class="o">-</span><span class="mi">45</span><span class="p">:</span><span class="mi">45</span><span class="p">),</span><span class="n">factor</span><span class="w"></span>
<span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">nmax</span><span class="p">,</span><span class="n">method</span><span class="p">,</span><span class="n">signh</span><span class="p">,</span><span class="n">fcount</span><span class="p">,</span><span class="n">init</span><span class="w"></span>
<span class="w">    </span><span class="kt">logical</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ignore</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">contin</span><span class="p">,</span><span class="n">saved</span><span class="w"></span>
<span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">dummy1</span><span class="p">,</span><span class="n">dummy2</span><span class="w"></span>

<span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">eta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">digits</span><span class="p">(</span><span class="mf">1.0_wp</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w">       </span><span class="c">!! minimum number of significant binary digits (apart from the</span>
<span class="w">                                                        </span><span class="c">!! sign digit) used to represent the mantissa of real(wp) numbers. it should</span>
<span class="w">                                                        </span><span class="c">!! be decreased by one if the computer truncates rather than rounds.</span>
<span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">inf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="nb">minexponent</span><span class="p">(</span><span class="mf">1.0_wp</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="c">!! the largest possible positive integers subject to</span>
<span class="w">                                                        </span><span class="c">!! 2**(-inf) and -2**(-inf) being representable real(wp) numbers.</span>
<span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">sup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">maxexponent</span><span class="p">(</span><span class="mf">1.0_wp</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="c">!! the largest possible positive integers subject to</span>
<span class="w">                                                        </span><span class="c">!! 2**sup and -2**sup being representable real(wp) numbers.</span>

<span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">sqrt2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sqrt</span><span class="p">(</span><span class="mf">2.0_wp</span><span class="p">)</span><span class="w">  </span><span class="c">!! \( \sqrt(2) \)</span>
<span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">sqrt3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sqrt</span><span class="p">(</span><span class="mf">3.0_wp</span><span class="p">)</span><span class="w">  </span><span class="c">!! \( \sqrt(3) \)</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">iord</span><span class="o">&lt;</span><span class="mi">1</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">iord</span><span class="o">&gt;</span><span class="mi">3</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">xmax</span><span class="o">&lt;=</span><span class="n">xmin</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">        </span><span class="n">x0</span><span class="o">&gt;</span><span class="n">xmax</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">x0</span><span class="o">&lt;</span><span class="n">xmin</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="p">.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="nb">associated</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">f</span><span class="p">))</span><span class="w"> </span><span class="k">then</span>

<span class="k">      </span><span class="n">ifail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>

<span class="w">    </span><span class="k">else</span>

<span class="k">        </span><span class="n">acc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">accr</span><span class="w"></span>
<span class="w">        </span><span class="n">twoinf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.0_wp</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">inf</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">twosup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.0_wp</span><span class="o">**</span><span class="n">sup</span><span class="w"></span>
<span class="w">        </span><span class="n">factor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.0_wp</span><span class="o">**</span><span class="p">(</span><span class="kt">real</span><span class="p">((</span><span class="n">inf</span><span class="o">+</span><span class="n">sup</span><span class="p">),</span><span class="n">wp</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span><span class="mf">0.0_wp</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">factor</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">25</span><span class="mf">6.0_wp</span><span class="p">)</span><span class="n">factor</span><span class="o">=</span><span class="mi">25</span><span class="mf">6.0_wp</span><span class="w"></span>
<span class="w">        </span><span class="n">maxh1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xmax</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x0</span><span class="w"></span>
<span class="w">        </span><span class="n">signh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x0</span><span class="o">-</span><span class="n">xmin</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">maxh1</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">          </span><span class="n">maxh2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">xmin</span><span class="w"></span>
<span class="w">        </span><span class="k">else</span>
<span class="k">          </span><span class="n">maxh2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">maxh1</span><span class="w"></span>
<span class="w">          </span><span class="n">maxh1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">xmin</span><span class="w"></span>
<span class="w">          </span><span class="n">signh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="w">        </span><span class="k">end if</span>
<span class="k">        </span><span class="n">relacc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.0_wp</span><span class="o">**</span><span class="p">(</span><span class="mf">1.0_wp</span><span class="o">-</span><span class="n">eta</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">maxh1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mf">1.0_wp</span><span class="o">-</span><span class="n">relacc</span><span class="p">)</span><span class="o">*</span><span class="n">maxh1</span><span class="w"></span>
<span class="w">        </span><span class="n">maxh2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mf">1.0_wp</span><span class="o">-</span><span class="n">relacc</span><span class="p">)</span><span class="o">*</span><span class="n">maxh2</span><span class="w"></span>
<span class="w">        </span><span class="n">s</span><span class="o">=</span><span class="mi">12</span><span class="mf">8.0_wp</span><span class="o">*</span><span class="n">twoinf</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">12</span><span class="mf">8.0_wp</span><span class="o">*</span><span class="n">twoinf</span><span class="o">*</span><span class="mf">2.0_wp</span><span class="o">**</span><span class="n">eta</span><span class="p">)</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span><span class="o">*</span><span class="mf">2.0_wp</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">eta</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">maxh1</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="k">then</span><span class="w"></span>
<span class="w">          </span><span class="c">! interval too small</span>
<span class="w">          </span><span class="n">ifail</span><span class="w"> </span><span class="o">=</span><span class="mi">3</span><span class="w"></span>
<span class="w">          </span><span class="k">return</span>
<span class="k">        end if</span>
<span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="n">acc</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.0_wp</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">          if</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="n">acc</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">relacc</span><span class="p">)</span><span class="w"> </span><span class="n">relacc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">acc</span><span class="w"></span>
<span class="w">          </span><span class="n">acc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0_wp</span><span class="w"></span>
<span class="w">        </span><span class="k">end if</span><span class="w"></span>

<span class="w">        </span><span class="c">! determine the smallest spacing at which the calculated</span>
<span class="w">        </span><span class="c">! function values are unequal near x0.</span>

<span class="w">        </span><span class="n">f0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">f</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">twof0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">f0</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">twoinf</span><span class="o">*</span><span class="mf">2.0_wp</span><span class="o">**</span><span class="n">eta</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">          </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span><span class="o">*</span><span class="mf">2.0_wp</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">eta</span><span class="p">)</span><span class="w"></span>
<span class="w">          </span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.0_wp</span><span class="w"></span>
<span class="w">        </span><span class="k">else</span>
<span class="k">          </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">twoinf</span><span class="w"></span>
<span class="w">          </span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="mf">4.0_wp</span><span class="w"></span>
<span class="w">        </span><span class="k">end if</span>
<span class="k">        </span><span class="n">df1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">f</span><span class="p">(</span><span class="n">x0</span><span class="o">+</span><span class="n">signh</span><span class="o">*</span><span class="n">h</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">f0</span><span class="w"></span>
<span class="w">        </span><span class="k">do</span>
<span class="k">            if</span><span class="w"> </span><span class="p">(</span><span class="n">df1</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mf">0.0_wp</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">z</span><span class="o">*</span><span class="n">h</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">maxh1</span><span class="p">)</span><span class="w"> </span><span class="k">exit</span>
<span class="k">            </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">z</span><span class="o">*</span><span class="n">h</span><span class="w"></span>
<span class="w">            </span><span class="n">df1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">f</span><span class="p">(</span><span class="n">x0</span><span class="o">+</span><span class="n">signh</span><span class="o">*</span><span class="n">h</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">f0</span><span class="w"></span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">z</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mf">2.0_wp</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">              if</span><span class="w"> </span><span class="p">(</span><span class="n">df1</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mf">0.0_wp</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">h</span><span class="o">/</span><span class="n">z</span><span class="w"></span>
<span class="w">                </span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.0_wp</span><span class="w"></span>
<span class="w">                </span><span class="n">df1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0_wp</span><span class="w"></span>
<span class="w">              </span><span class="k">else</span>
<span class="k">                if</span><span class="w"> </span><span class="p">(</span><span class="n">z</span><span class="o">*</span><span class="n">h</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">maxh1</span><span class="p">)</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.0_wp</span><span class="w"></span>
<span class="w">              </span><span class="k">end if</span>
<span class="k">            end if</span>
<span class="k">        end do</span>

<span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="n">df1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0.0_wp</span><span class="p">)</span><span class="w"> </span><span class="k">then</span><span class="w"></span>
<span class="w">        </span><span class="c">! constant function</span>
<span class="w">          </span><span class="n">deriv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0_wp</span><span class="w"></span>
<span class="w">          </span><span class="n">error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0_wp</span><span class="w"></span>
<span class="w">          </span><span class="n">ifail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">          </span><span class="k">return</span>
<span class="k">        end if</span>
<span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="n">h</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">maxh1</span><span class="o">/</span><span class="mi">12</span><span class="mf">8.0_wp</span><span class="p">)</span><span class="w"> </span><span class="k">then</span><span class="w"></span>
<span class="w">        </span><span class="c">! minimum h too large</span>
<span class="w">          </span><span class="n">ifail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="w"></span>
<span class="w">          </span><span class="k">return</span>
<span class="k">        end if</span>

<span class="k">        </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">8.0_wp</span><span class="o">*</span><span class="n">h</span><span class="w"></span>
<span class="w">        </span><span class="n">h1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">signh</span><span class="o">*</span><span class="n">h</span><span class="w"></span>
<span class="w">        </span><span class="n">h0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">h1</span><span class="w"></span>
<span class="w">        </span><span class="n">h2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">h1</span><span class="w"></span>
<span class="w">        </span><span class="n">minh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.0_wp</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="nb">min</span><span class="p">(</span><span class="n">inf</span><span class="p">,</span><span class="n">sup</span><span class="p">)</span><span class="o">/</span><span class="n">iord</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">minh</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">h</span><span class="p">)</span><span class="w"> </span><span class="n">minh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">h</span><span class="w"></span>
<span class="w">        </span><span class="k">select case</span><span class="w"> </span><span class="p">(</span><span class="n">iord</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="k">case</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">8.0_wp</span><span class="w"></span>
<span class="w">        </span><span class="k">case</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">9.0_wp</span><span class="o">*</span><span class="n">sqrt3</span><span class="w"></span>
<span class="w">        </span><span class="k">case</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="mf">7.0_wp</span><span class="w"></span>
<span class="w">        </span><span class="k">end select</span>
<span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="n">minh</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">maxh1</span><span class="o">/</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">          </span><span class="n">ifail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="w"></span>
<span class="w">          </span><span class="k">return</span>
<span class="k">        end if</span>
<span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="n">minh</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">maxh2</span><span class="o">/</span><span class="n">s</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">maxh2</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">12</span><span class="mf">8.0_wp</span><span class="o">*</span><span class="n">twoinf</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">          </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">        </span><span class="k">else</span>
<span class="k">          </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="w">        </span><span class="k">end if</span><span class="w"></span>

<span class="w">        </span><span class="c">! method 1 uses 1-sided formulae, and method 2 symmetric.</span>
<span class="w">        </span><span class="c">! now estimate accuracy of calculated function values.</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">iord</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">          if</span><span class="w"> </span><span class="p">(</span><span class="n">x0</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mf">0.0_wp</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">            </span><span class="n">dummy1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0_wp</span><span class="w"></span>
<span class="w">            </span><span class="n">dummy2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">h1</span><span class="w"></span>
<span class="w">            </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">faccur</span><span class="p">(</span><span class="n">dummy1</span><span class="p">,</span><span class="n">dummy2</span><span class="p">,</span><span class="n">acc0</span><span class="p">,</span><span class="n">x0</span><span class="p">,</span><span class="n">twoinf</span><span class="p">,</span><span class="n">f0</span><span class="p">,</span><span class="n">f1</span><span class="p">)</span><span class="w"></span>
<span class="w">          </span><span class="k">else</span>
<span class="k">            </span><span class="n">acc0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0_wp</span><span class="w"></span>
<span class="w">          </span><span class="k">end if</span>
<span class="k">        end if</span>

<span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">h1</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">twosup</span><span class="o">/</span><span class="mi">12</span><span class="mf">8.0_wp</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">          </span><span class="n">hacc1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">twosup</span><span class="w"></span>
<span class="w">        </span><span class="k">else</span>
<span class="k">          </span><span class="n">hacc1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">12</span><span class="mf">8.0_wp</span><span class="o">*</span><span class="n">h1</span><span class="w"></span>
<span class="w">        </span><span class="k">end if</span>

<span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">hacc1</span><span class="p">)</span><span class="o">/</span><span class="mf">4.0_wp</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">minh</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">          </span><span class="n">hacc1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">4.0_wp</span><span class="o">*</span><span class="n">signh</span><span class="o">*</span><span class="n">minh</span><span class="w"></span>
<span class="w">        </span><span class="k">else if</span><span class="w"> </span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">hacc1</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">maxh1</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">          </span><span class="n">hacc1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">signh</span><span class="o">*</span><span class="n">maxh1</span><span class="w"></span>
<span class="w">        </span><span class="k">end if</span>
<span class="k">        </span><span class="n">f1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">f</span><span class="p">(</span><span class="n">x0</span><span class="o">+</span><span class="n">hacc1</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">faccur</span><span class="p">(</span><span class="n">hacc1</span><span class="p">,</span><span class="n">h1</span><span class="p">,</span><span class="n">acc1</span><span class="p">,</span><span class="n">x0</span><span class="p">,</span><span class="n">twoinf</span><span class="p">,</span><span class="n">f0</span><span class="p">,</span><span class="n">f1</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">          </span><span class="n">hacc2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">hacc1</span><span class="w"></span>
<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">hacc2</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">maxh2</span><span class="p">)</span><span class="w"> </span><span class="n">hacc2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">signh</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">maxh2</span><span class="w"></span>
<span class="w">          </span><span class="n">f1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">f</span><span class="p">(</span><span class="n">x0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">hacc2</span><span class="p">)</span><span class="w"></span>
<span class="w">          </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">faccur</span><span class="p">(</span><span class="n">hacc2</span><span class="p">,</span><span class="n">h2</span><span class="p">,</span><span class="n">acc2</span><span class="p">,</span><span class="n">x0</span><span class="p">,</span><span class="n">twoinf</span><span class="p">,</span><span class="n">f0</span><span class="p">,</span><span class="n">f1</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="k">end if</span>
<span class="k">        </span><span class="n">nmax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">eta</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">36</span><span class="p">)</span><span class="w"> </span><span class="n">nmax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="w"></span>
<span class="w">        </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="w">        </span><span class="n">fcount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">        </span><span class="n">deriv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0_wp</span><span class="w"></span>
<span class="w">        </span><span class="n">error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">twosup</span><span class="w"></span>
<span class="w">        </span><span class="n">init</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="w"></span>
<span class="w">        </span><span class="n">contin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>

<span class="w">        </span><span class="k">do</span>

<span class="k">            </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="w"></span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="n">contin</span><span class="p">)</span><span class="w"> </span><span class="k">exit</span>

<span class="k">            if</span><span class="w"> </span><span class="p">(</span><span class="n">init</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="k">then</span><span class="w"></span>
<span class="w">            </span><span class="c">! calculate coefficients for differentiation</span>
<span class="w">            </span><span class="c">! formulae and neville extrapolation algorithm</span>
<span class="w">              </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">iord</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                </span><span class="n">beta</span><span class="o">=</span><span class="mf">2.0_wp</span><span class="w"></span>
<span class="w">              </span><span class="k">else if</span><span class="w"> </span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                </span><span class="n">beta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt2</span><span class="w"></span>
<span class="w">              </span><span class="k">else</span>
<span class="k">                </span><span class="n">beta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt3</span><span class="w"></span>
<span class="w">              </span><span class="k">end if</span>
<span class="k">              </span><span class="n">beta4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">beta</span><span class="o">**</span><span class="mi">4</span><span class="w"></span>
<span class="w">              </span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">beta</span><span class="w"></span>
<span class="w">              </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">z</span><span class="o">**</span><span class="mi">2</span><span class="w"></span>
<span class="w">              </span><span class="n">zpower</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0_wp</span><span class="w"></span>
<span class="w">              </span><span class="k">do </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="n">nmax</span><span class="w"></span>
<span class="w">                </span><span class="n">zpower</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">z</span><span class="o">*</span><span class="n">zpower</span><span class="w"></span>
<span class="w">                </span><span class="n">denom</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zpower</span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="w">              </span><span class="k">end do</span>
<span class="k">              if</span><span class="w"> </span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">iord</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                </span><span class="n">e</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">5.0_wp</span><span class="w"></span>
<span class="w">                </span><span class="n">e</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">6.3_wp</span><span class="w"></span>
<span class="w">                </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="n">nmax</span><span class="w"></span>
<span class="w">                  </span><span class="n">e</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">6.81_wp</span><span class="w"></span>
<span class="w">                </span><span class="k">end do</span>
<span class="k">              else if</span><span class="w"> </span><span class="p">((</span><span class="n">method</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">iord</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">                       </span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">iord</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">))</span><span class="w"> </span><span class="k">then</span>
<span class="k">                </span><span class="n">e</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="mf">0.0_wp</span><span class="w"></span>
<span class="w">                </span><span class="n">e</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="mf">6.0_wp</span><span class="w"></span>
<span class="w">                </span><span class="n">e</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="mf">0.36_wp</span><span class="w"></span>
<span class="w">                </span><span class="n">e</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="mf">3.0_wp</span><span class="w"></span>
<span class="w">                </span><span class="n">e</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="mf">4.46_wp</span><span class="w"></span>
<span class="w">                </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="n">nmax</span><span class="w"></span>
<span class="w">                  </span><span class="n">e</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="mf">6.0_wp</span><span class="w"></span>
<span class="w">                </span><span class="k">end do</span>
<span class="k">                if</span><span class="w"> </span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">iord</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                  do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="n">nmax</span><span class="w"></span>
<span class="w">                    </span><span class="n">e</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">=</span><span class="mf">2.0_wp</span><span class="o">*</span><span class="n">e</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">end do</span>
<span class="k">                end if</span>
<span class="k">              else if</span><span class="w"> </span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">iord</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                </span><span class="n">e</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="mf">7.78_wp</span><span class="w"></span>
<span class="w">                </span><span class="n">e</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="mf">0.06_wp</span><span class="w"></span>
<span class="w">                </span><span class="n">e</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="mf">9.66_wp</span><span class="w"></span>
<span class="w">                </span><span class="n">e</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="mf">6.16_wp</span><span class="w"></span>
<span class="w">                </span><span class="n">e</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="mf">0.26_wp</span><span class="w"></span>
<span class="w">                </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="n">nmax</span><span class="w"></span>
<span class="w">                  </span><span class="n">e</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="mf">5.0_wp</span><span class="w"></span>
<span class="w">                </span><span class="k">end do</span>
<span class="k">              else if</span><span class="w"> </span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">iord</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                </span><span class="n">e</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="mf">5.97_wp</span><span class="w"></span>
<span class="w">                </span><span class="n">e</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="mf">1.22_wp</span><span class="w"></span>
<span class="w">                </span><span class="n">e</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="mf">0.95_wp</span><span class="w"></span>
<span class="w">                </span><span class="n">e</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="mf">6.4_wp</span><span class="w"></span>
<span class="w">                </span><span class="n">e</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="mf">9.3_wp</span><span class="w"></span>
<span class="w">                </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="n">nmax</span><span class="w"></span>
<span class="w">                  </span><span class="n">e</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="mf">2.0_wp</span><span class="w"></span>
<span class="w">                </span><span class="k">end do</span>
<span class="k">              else</span>
<span class="k">                </span><span class="n">e</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="mf">4.5_wp</span><span class="w"></span>
<span class="w">                </span><span class="n">e</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="mf">0.4_wp</span><span class="w"></span>
<span class="w">                </span><span class="n">e</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="mf">2.78_wp</span><span class="w"></span>
<span class="w">                </span><span class="n">e</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="mf">1.2_wp</span><span class="w"></span>
<span class="w">                </span><span class="n">e</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="mf">6.55_wp</span><span class="w"></span>
<span class="w">                </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="n">nmax</span><span class="w"></span>
<span class="w">                  </span><span class="n">e</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">7</span><span class="mf">3.0_wp</span><span class="w"></span>
<span class="w">                </span><span class="k">end do</span>
<span class="k">                </span><span class="n">c0f0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">twof0</span><span class="o">/</span><span class="p">(</span><span class="mf">3.0_wp</span><span class="o">*</span><span class="n">beta</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="n">c1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3.0_wp</span><span class="o">/</span><span class="p">(</span><span class="mf">3.0_wp</span><span class="o">*</span><span class="n">beta</span><span class="o">-</span><span class="mf">1.0_wp</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="n">c2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mf">1.0_wp</span><span class="o">/</span><span class="p">(</span><span class="mf">3.0_wp</span><span class="o">*</span><span class="p">(</span><span class="n">beta</span><span class="o">-</span><span class="mf">1.0_wp</span><span class="p">))</span><span class="w"></span>
<span class="w">                </span><span class="n">c3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0_wp</span><span class="o">/</span><span class="p">(</span><span class="mf">3.0_wp</span><span class="o">*</span><span class="n">beta</span><span class="o">*</span><span class="p">(</span><span class="mf">5.0_wp</span><span class="o">-</span><span class="mf">2.0_wp</span><span class="o">*</span><span class="n">beta</span><span class="p">))</span><span class="w"></span>
<span class="w">              </span><span class="k">end if</span>
<span class="k">            end if</span>

<span class="k">            if</span><span class="w"> </span><span class="p">(</span><span class="n">init</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">then</span><span class="w"></span>
<span class="w">            </span><span class="c">! initialization of steplengths, accuracy and other parameters</span>

<span class="w">              </span><span class="n">heval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">signh</span><span class="o">*</span><span class="n">minh</span><span class="w"></span>
<span class="w">              </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">heval</span><span class="w"></span>
<span class="w">              </span><span class="n">baseh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">heval</span><span class="w"></span>
<span class="w">              </span><span class="n">maxh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">maxh2</span><span class="w"></span>
<span class="w">              </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="n">maxh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">maxh1</span><span class="w"></span>
<span class="w">              </span><span class="k">do </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="n">nmax</span><span class="w"></span>
<span class="w">                </span><span class="n">minerr</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">twosup</span><span class="w"></span>
<span class="w">                </span><span class="n">ignore</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="w">              </span><span class="k">end do</span>
<span class="k">              if</span><span class="w"> </span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">newacc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">acc1</span><span class="w"></span>
<span class="w">              </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">newacc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">acc2</span><span class="w"></span>
<span class="w">              </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="n">newacc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">acc1</span><span class="o">+</span><span class="n">acc2</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0_wp</span><span class="w"></span>
<span class="w">              </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">newacc</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">acc</span><span class="p">)</span><span class="w"> </span><span class="n">newacc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">acc</span><span class="w"></span>
<span class="w">              </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">method</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">iord</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">newacc</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">acc0</span><span class="p">)</span><span class="w"> </span><span class="n">newacc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">acc0</span><span class="w"></span>
<span class="w">              </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                </span><span class="n">facc1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">acc1</span><span class="w"></span>
<span class="w">                </span><span class="n">nhacc1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hacc1</span><span class="w"></span>
<span class="w">                </span><span class="n">newh1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">h1</span><span class="w"></span>
<span class="w">              </span><span class="k">end if</span>
<span class="k">              if</span><span class="w"> </span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                </span><span class="n">facc2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">acc2</span><span class="w"></span>
<span class="w">                </span><span class="n">nhacc2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hacc2</span><span class="w"></span>
<span class="w">                </span><span class="n">newh2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">h2</span><span class="w"></span>
<span class="w">              </span><span class="k">else</span>
<span class="k">                </span><span class="n">facc2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0_wp</span><span class="w"></span>
<span class="w">                </span><span class="n">nhacc2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0_wp</span><span class="w"></span>
<span class="w">              </span><span class="k">end if</span>
<span class="k">              </span><span class="n">init</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">              </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">              </span><span class="n">saved</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="w">            </span><span class="k">end if</span><span class="w"></span>

<span class="w">            </span><span class="c">! calculate new or initial function values</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">init</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">iord</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">                  </span><span class="p">.</span><span class="nb">not</span><span class="p">.(</span><span class="n">method</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">fcount</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">45</span><span class="p">))</span><span class="w"> </span><span class="k">then</span>
<span class="k">              if</span><span class="w"> </span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                </span><span class="n">fcount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fcount</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                </span><span class="n">f1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">f</span><span class="p">(</span><span class="n">x0</span><span class="o">+</span><span class="n">heval</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="n">storef</span><span class="p">(</span><span class="n">fcount</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f1</span><span class="w"></span>
<span class="w">                </span><span class="n">f2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">f</span><span class="p">(</span><span class="n">x0</span><span class="o">-</span><span class="n">heval</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="n">storef</span><span class="p">(</span><span class="o">-</span><span class="n">fcount</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f2</span><span class="w"></span>
<span class="w">              </span><span class="k">else</span>
<span class="k">                </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="w"></span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">fcount</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                  </span><span class="n">f1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">storef</span><span class="p">(</span><span class="n">j</span><span class="o">*</span><span class="n">method</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="k">else</span>
<span class="k">                  </span><span class="n">f1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">f</span><span class="p">(</span><span class="n">x0</span><span class="o">+</span><span class="n">heval</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="k">end if</span>
<span class="k">              end if</span>
<span class="k">            else</span>
<span class="k">              </span><span class="n">f1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">f</span><span class="p">(</span><span class="n">x0</span><span class="o">+</span><span class="n">heval</span><span class="p">)</span><span class="w"></span>
<span class="w">              </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="n">f2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">f</span><span class="p">(</span><span class="n">x0</span><span class="o">-</span><span class="n">heval</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">end if</span>
<span class="k">            if</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">              if</span><span class="w"> </span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">iord</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                </span><span class="n">pdelta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f1</span><span class="o">-</span><span class="n">f2</span><span class="w"></span>
<span class="w">                </span><span class="n">pmaxf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">f1</span><span class="p">)</span><span class="o">+</span><span class="nb">abs</span><span class="p">(</span><span class="n">f2</span><span class="p">))</span><span class="o">/</span><span class="mf">2.0_wp</span><span class="w"></span>
<span class="w">                </span><span class="n">heval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">beta</span><span class="o">*</span><span class="n">heval</span><span class="w"></span>
<span class="w">                </span><span class="n">f1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">f</span><span class="p">(</span><span class="n">x0</span><span class="o">+</span><span class="n">heval</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="n">f2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">f</span><span class="p">(</span><span class="n">x0</span><span class="o">-</span><span class="n">heval</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="n">deltaf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f1</span><span class="o">-</span><span class="n">f2</span><span class="w"></span>
<span class="w">                </span><span class="n">maxfun</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">f1</span><span class="p">)</span><span class="o">+</span><span class="nb">abs</span><span class="p">(</span><span class="n">f2</span><span class="p">))</span><span class="o">/</span><span class="mf">2.0_wp</span><span class="w"></span>
<span class="w">                </span><span class="n">heval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">beta</span><span class="o">*</span><span class="n">heval</span><span class="w"></span>
<span class="w">                </span><span class="n">f1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">f</span><span class="p">(</span><span class="n">x0</span><span class="o">+</span><span class="n">heval</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="n">f2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">f</span><span class="p">(</span><span class="n">x0</span><span class="o">-</span><span class="n">heval</span><span class="p">)</span><span class="w"></span>
<span class="w">              </span><span class="k">else if</span><span class="w"> </span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">iord</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                if</span><span class="w"> </span><span class="p">(</span><span class="n">iord</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                  </span><span class="n">f3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f1</span><span class="w"></span>
<span class="w">                </span><span class="k">else</span>
<span class="k">                  </span><span class="n">f4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f1</span><span class="w"></span>
<span class="w">                  </span><span class="n">heval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">beta</span><span class="o">*</span><span class="n">heval</span><span class="w"></span>
<span class="w">                  </span><span class="n">f3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">f</span><span class="p">(</span><span class="n">x0</span><span class="o">+</span><span class="n">heval</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="k">end if</span>
<span class="k">                </span><span class="n">heval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">beta</span><span class="o">*</span><span class="n">heval</span><span class="w"></span>
<span class="w">                </span><span class="n">f2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">f</span><span class="p">(</span><span class="n">x0</span><span class="o">+</span><span class="n">heval</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="n">heval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">beta</span><span class="o">*</span><span class="n">heval</span><span class="w"></span>
<span class="w">                </span><span class="n">f1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">f</span><span class="p">(</span><span class="n">x0</span><span class="o">+</span><span class="n">heval</span><span class="p">)</span><span class="w"></span>
<span class="w">              </span><span class="k">end if</span>
<span class="k">            end if</span><span class="w"></span>

<span class="w">            </span><span class="c">! evaluate a new approximation dnew to the derivative</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">nmax</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">              </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nmax</span><span class="w"></span>
<span class="w">              </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="w"></span>
<span class="w">                </span><span class="n">maxf</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">maxf</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"></span>
<span class="w">              </span><span class="k">end do</span>
<span class="k">            end if</span>
<span class="k">            if</span><span class="w"> </span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">              </span><span class="n">maxf</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">f1</span><span class="p">)</span><span class="o">+</span><span class="nb">abs</span><span class="p">(</span><span class="n">f2</span><span class="p">))</span><span class="o">/</span><span class="mf">2.0_wp</span><span class="w"></span>
<span class="w">              </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">iord</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                </span><span class="n">dnew</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">f1</span><span class="o">-</span><span class="n">f2</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0_wp</span><span class="w"></span>
<span class="w">              </span><span class="k">else if</span><span class="w"> </span><span class="p">(</span><span class="n">iord</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                </span><span class="n">dnew</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f1</span><span class="o">+</span><span class="n">f2</span><span class="o">-</span><span class="n">twof0</span><span class="w"></span>
<span class="w">              </span><span class="k">else</span>
<span class="k">                </span><span class="n">dnew</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">pdelta</span><span class="w"></span>
<span class="w">                </span><span class="n">pdelta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">deltaf</span><span class="w"></span>
<span class="w">                </span><span class="n">deltaf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f1</span><span class="o">-</span><span class="n">f2</span><span class="w"></span>
<span class="w">                </span><span class="n">dnew</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dnew</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.5_wp</span><span class="o">*</span><span class="n">deltaf</span><span class="w"></span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">maxf</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">pmaxf</span><span class="p">)</span><span class="w"> </span><span class="n">maxf</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pmaxf</span><span class="w"></span>
<span class="w">                </span><span class="n">pmaxf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">maxfun</span><span class="w"></span>
<span class="w">                </span><span class="n">maxfun</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">f1</span><span class="p">)</span><span class="o">+</span><span class="nb">abs</span><span class="p">(</span><span class="n">f2</span><span class="p">))</span><span class="o">/</span><span class="mf">2.0_wp</span><span class="w"></span>
<span class="w">              </span><span class="k">end if</span>
<span class="k">            else</span>
<span class="k">              </span><span class="n">maxf</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="n">f1</span><span class="p">)</span><span class="w"></span>
<span class="w">              </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">iord</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                </span><span class="n">dnew</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f1</span><span class="o">-</span><span class="n">f0</span><span class="w"></span>
<span class="w">              </span><span class="k">else if</span><span class="w"> </span><span class="p">(</span><span class="n">iord</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                </span><span class="n">dnew</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">twof0</span><span class="o">-</span><span class="mf">3.0_wp</span><span class="o">*</span><span class="n">f3</span><span class="o">+</span><span class="n">f1</span><span class="p">)</span><span class="o">/</span><span class="mf">3.0_wp</span><span class="w"></span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">maxf</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="n">f3</span><span class="p">))</span><span class="w"> </span><span class="n">maxf</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="n">f3</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="n">f3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f2</span><span class="w"></span>
<span class="w">                </span><span class="n">f2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f1</span><span class="w"></span>
<span class="w">              </span><span class="k">else</span>
<span class="k">                </span><span class="n">dnew</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c3</span><span class="o">*</span><span class="n">f1</span><span class="o">+</span><span class="n">c2</span><span class="o">*</span><span class="n">f2</span><span class="o">+</span><span class="n">c1</span><span class="o">*</span><span class="n">f4</span><span class="o">+</span><span class="n">c0f0</span><span class="w"></span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">maxf</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="n">f2</span><span class="p">))</span><span class="w"> </span><span class="n">maxf</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="n">f2</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">maxf</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="n">f4</span><span class="p">))</span><span class="w"> </span><span class="n">maxf</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="n">f4</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="n">f4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f3</span><span class="w"></span>
<span class="w">                </span><span class="n">f3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f2</span><span class="w"></span>
<span class="w">                </span><span class="n">f2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f1</span><span class="w"></span>
<span class="w">              </span><span class="k">end if</span>
<span class="k">            end if</span>
<span class="k">            if</span><span class="w"> </span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">h</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">              </span><span class="n">dnew</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dnew</span><span class="o">/</span><span class="n">h</span><span class="o">**</span><span class="n">iord</span><span class="w"></span>
<span class="w">            </span><span class="k">else</span>
<span class="k">              if</span><span class="w"> </span><span class="p">(</span><span class="mi">12</span><span class="mf">8.0_wp</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">dnew</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">twosup</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">h</span><span class="p">)</span><span class="o">**</span><span class="n">iord</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                </span><span class="n">dnew</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">twosup</span><span class="o">/</span><span class="mi">12</span><span class="mf">8.0_wp</span><span class="w"></span>
<span class="w">              </span><span class="k">else</span>
<span class="k">                </span><span class="n">dnew</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dnew</span><span class="o">/</span><span class="n">h</span><span class="o">**</span><span class="n">iord</span><span class="w"></span>
<span class="w">              </span><span class="k">end if</span>
<span class="k">            end if</span>

<span class="k">            if</span><span class="w"> </span><span class="p">(</span><span class="n">init</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span><span class="w"></span>
<span class="w">            </span><span class="c">! update estimated accuracy of function values</span>
<span class="w">              </span><span class="n">newacc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">acc</span><span class="w"></span>
<span class="w">              </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">method</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">iord</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">newacc</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">acc0</span><span class="p">)</span><span class="w"> </span><span class="n">newacc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">acc0</span><span class="w"></span>
<span class="w">              </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="n">nhacc1</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">1.125_wp</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">heval</span><span class="p">)</span><span class="o">/</span><span class="n">beta4</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                </span><span class="n">nhacc1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">heval</span><span class="w"></span>
<span class="w">                </span><span class="n">pacc1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">facc1</span><span class="w"></span>
<span class="w">                </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">faccur</span><span class="p">(</span><span class="n">nhacc1</span><span class="p">,</span><span class="n">newh1</span><span class="p">,</span><span class="n">facc1</span><span class="p">,</span><span class="n">x0</span><span class="p">,</span><span class="n">twoinf</span><span class="p">,</span><span class="n">f0</span><span class="p">,</span><span class="n">f1</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">facc1</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">pacc1</span><span class="p">)</span><span class="w"> </span><span class="n">facc1</span><span class="o">=</span><span class="p">(</span><span class="mf">3.0_wp</span><span class="o">*</span><span class="n">facc1</span><span class="o">+</span><span class="n">pacc1</span><span class="p">)</span><span class="o">/</span><span class="mf">4.0_wp</span><span class="w"></span>
<span class="w">              </span><span class="k">end if</span>
<span class="k">              if</span><span class="w"> </span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="n">nhacc2</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">1.125_wp</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">heval</span><span class="p">)</span><span class="o">/</span><span class="n">beta4</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                if</span><span class="w"> </span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                  </span><span class="n">f1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f2</span><span class="w"></span>
<span class="w">                  </span><span class="n">nhacc2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">heval</span><span class="w"></span>
<span class="w">                </span><span class="k">else</span>
<span class="k">                  </span><span class="n">nhacc2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">heval</span><span class="w"></span>
<span class="w">                </span><span class="k">end if</span>
<span class="k">                </span><span class="n">pacc2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">facc2</span><span class="w"></span>
<span class="w">                </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">faccur</span><span class="p">(</span><span class="n">nhacc2</span><span class="p">,</span><span class="n">newh2</span><span class="p">,</span><span class="n">facc2</span><span class="p">,</span><span class="n">x0</span><span class="p">,</span><span class="n">twoinf</span><span class="p">,</span><span class="n">f0</span><span class="p">,</span><span class="n">f1</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">facc2</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">pacc2</span><span class="p">)</span><span class="w"> </span><span class="n">facc2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mf">3.0_wp</span><span class="o">*</span><span class="n">facc2</span><span class="o">+</span><span class="n">pacc2</span><span class="p">)</span><span class="o">/</span><span class="mf">4.0_wp</span><span class="w"></span>
<span class="w">              </span><span class="k">end if</span>
<span class="k">              if</span><span class="w"> </span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">newacc</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">facc1</span><span class="p">)</span><span class="w"> </span><span class="n">newacc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">facc1</span><span class="w"></span>
<span class="w">              </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">newacc</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">facc2</span><span class="p">)</span><span class="w"> </span><span class="n">newacc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">facc2</span><span class="w"></span>
<span class="w">              </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">newacc</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">facc1</span><span class="o">+</span><span class="n">facc2</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0_wp</span><span class="p">)</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">                      </span><span class="n">newacc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">facc1</span><span class="o">+</span><span class="n">facc2</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0_wp</span><span class="w"></span>
<span class="w">            </span><span class="k">end if</span><span class="w"></span>

<span class="w">            </span><span class="c">! evaluate successive elements of the current row in the neville</span>
<span class="w">            </span><span class="c">! array, estimating and examining the truncation and rounding</span>
<span class="w">            </span><span class="c">! errors in each</span>

<span class="w">            </span><span class="n">contin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">nmax</span><span class="w"></span>
<span class="w">            </span><span class="n">hprev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="n">h</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="n">fmax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">maxf</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">method</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">iord</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">fmax</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="n">f0</span><span class="p">))</span><span class="w"> </span><span class="n">fmax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="n">f0</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="k">do </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="w"></span>
<span class="w">              </span><span class="n">dprev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">d</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"></span>
<span class="w">              </span><span class="n">d</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dnew</span><span class="w"></span>
<span class="w">              </span><span class="n">dnew</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dprev</span><span class="o">+</span><span class="p">(</span><span class="n">dprev</span><span class="o">-</span><span class="n">dnew</span><span class="p">)</span><span class="o">/</span><span class="n">denom</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"></span>
<span class="w">              </span><span class="n">te</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="n">dnew</span><span class="o">-</span><span class="n">d</span><span class="p">(</span><span class="n">k</span><span class="p">))</span><span class="w"></span>
<span class="w">              </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fmax</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">maxf</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="n">k</span><span class="p">))</span><span class="w"> </span><span class="n">fmax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">maxf</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="n">k</span><span class="p">)</span><span class="w"></span>
<span class="w">              </span><span class="n">hprev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hprev</span><span class="o">/</span><span class="n">beta</span><span class="w"></span>
<span class="w">              </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">newacc</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">relacc</span><span class="o">*</span><span class="n">fmax</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                </span><span class="n">re</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newacc</span><span class="o">*</span><span class="n">e</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"></span>
<span class="w">              </span><span class="k">else</span>
<span class="k">                </span><span class="n">re</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">relacc</span><span class="o">*</span><span class="n">fmax</span><span class="o">*</span><span class="n">e</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"></span>
<span class="w">              </span><span class="k">end if</span>
<span class="k">              if</span><span class="w"> </span><span class="p">(</span><span class="n">re</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mf">0.0_wp</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                if</span><span class="w"> </span><span class="p">(</span><span class="n">hprev</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                  </span><span class="n">re</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">re</span><span class="o">/</span><span class="n">hprev</span><span class="o">**</span><span class="n">iord</span><span class="w"></span>
<span class="w">                </span><span class="k">else if</span><span class="w"> </span><span class="p">(</span><span class="mf">2.0_wp</span><span class="o">*</span><span class="n">re</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">twosup</span><span class="o">*</span><span class="n">hprev</span><span class="o">**</span><span class="n">iord</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                  </span><span class="n">re</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">twosup</span><span class="o">/</span><span class="mf">2.0_wp</span><span class="w"></span>
<span class="w">                </span><span class="k">else</span>
<span class="k">                  </span><span class="n">re</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">re</span><span class="o">/</span><span class="n">hprev</span><span class="o">**</span><span class="n">iord</span><span class="w"></span>
<span class="w">                </span><span class="k">end if</span>
<span class="k">              end if</span>
<span class="k">              </span><span class="n">newerr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">te</span><span class="o">+</span><span class="n">re</span><span class="w"></span>
<span class="w">              </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">te</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">re</span><span class="p">)</span><span class="w"> </span><span class="n">newerr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.25_wp</span><span class="o">*</span><span class="n">newerr</span><span class="w"></span>
<span class="w">              </span><span class="k">if</span><span class="w"> </span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="n">ignore</span><span class="p">(</span><span class="n">k</span><span class="p">))</span><span class="w"> </span><span class="k">then</span>
<span class="k">                if</span><span class="w"> </span><span class="p">((</span><span class="n">init</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">.</span><span class="nb">not</span><span class="p">.</span><span class="n">ignore</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">                      </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">newerr</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">error</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                  </span><span class="n">deriv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">d</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newerr</span><span class="w"></span>
<span class="w">                </span><span class="k">end if</span>
<span class="k">                if</span><span class="w"> </span><span class="p">(</span><span class="n">init</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                  </span><span class="n">tderiv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">d</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">temerr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newerr</span><span class="w"></span>
<span class="w">                </span><span class="k">end if</span>
<span class="k">                if</span><span class="w"> </span><span class="p">(</span><span class="n">minerr</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">twosup</span><span class="o">/</span><span class="mf">4.0_wp</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                  </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">4.0_wp</span><span class="o">*</span><span class="n">minerr</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="k">else</span>
<span class="k">                  </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">twosup</span><span class="w"></span>
<span class="w">                </span><span class="k">end if</span>
<span class="k">                if</span><span class="w"> </span><span class="p">(</span><span class="n">te</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">re</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">newerr</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                  </span><span class="n">ignore</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="w">                </span><span class="k">else</span>
<span class="k">                  </span><span class="n">contin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="w">                </span><span class="k">end if</span>
<span class="k">                if</span><span class="w"> </span><span class="p">(</span><span class="n">newerr</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">minerr</span><span class="p">(</span><span class="n">k</span><span class="p">))</span><span class="w"> </span><span class="n">minerr</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newerr</span><span class="w"></span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">init</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">.</span><span class="nb">not</span><span class="p">.</span><span class="n">ignore</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="w"> </span><span class="k">then</span>
<span class="k">                  if</span><span class="w"> </span><span class="p">(</span><span class="n">newerr</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">temerr</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                    </span><span class="n">tderiv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">d</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                    </span><span class="n">temerr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newerr</span><span class="w"></span>
<span class="w">                  </span><span class="k">end if</span>
<span class="k">                  if</span><span class="w"> </span><span class="p">(</span><span class="n">temerr</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">error</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                    </span><span class="n">deriv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tderiv</span><span class="w"></span>
<span class="w">                    </span><span class="n">error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temerr</span><span class="w"></span>
<span class="w">                  </span><span class="k">end if</span>
<span class="k">                end if</span>
<span class="k">              end if</span>
<span class="k">            end do</span>

<span class="k">            if</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">nmax</span><span class="p">)</span><span class="w"> </span><span class="n">d</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dnew</span><span class="w"></span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">eps</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.0_wp</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">              </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="n">eps</span><span class="o">*</span><span class="n">deriv</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">else</span>
<span class="k">              </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eps</span><span class="w"></span>
<span class="w">            </span><span class="k">end if</span>
<span class="k">            if</span><span class="w"> </span><span class="p">(</span><span class="n">error</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">              </span><span class="n">contin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="w">            </span><span class="k">else if</span><span class="w"> </span><span class="p">(</span><span class="n">init</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">ignore</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span><span class="w"> </span><span class="k">then</span>
<span class="k">              if</span><span class="w"> </span><span class="p">((</span><span class="n">ignore</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">ignore</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">saved</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                </span><span class="n">saved</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="w">                </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="w">                </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">beta</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">save</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="n">heval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">beta</span><span class="o">*</span><span class="k">save</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="n">maxf</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">save</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="n">maxf</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">save</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="n">maxf</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">save</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="n">d</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">save</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="n">d</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">save</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="n">d</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">save</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="n">minerr</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">save</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="n">minerr</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">save</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">iord</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                  </span><span class="n">pdelta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">save</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">deltaf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">save</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">pmaxf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">save</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">maxfun</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">save</span><span class="p">(</span><span class="mi">13</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="k">else if</span><span class="w"> </span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">iord</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                  </span><span class="n">f2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">save</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">f3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">save</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">iord</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="n">f4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">save</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="k">end if</span>
<span class="k">                </span><span class="n">init</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">                </span><span class="n">ignore</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="w">                </span><span class="n">ignore</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="w">              </span><span class="k">else if</span><span class="w"> </span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">ignore</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">ignore</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">                    </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">beta4</span><span class="o">*</span><span class="n">factor</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">heval</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">maxh</span><span class="p">)</span><span class="w"> </span><span class="k">then</span><span class="w"></span>
<span class="w">            </span><span class="c">! save all current values in case of return to current point</span>
<span class="w">                </span><span class="n">saved</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="w">                </span><span class="k">save</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">h</span><span class="w"></span>
<span class="w">                </span><span class="k">save</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">heval</span><span class="w"></span>
<span class="w">                </span><span class="k">save</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">maxf</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="k">save</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">maxf</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="k">save</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">maxf</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="k">save</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">d</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="k">save</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">d</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="k">save</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">d</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="k">save</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">minerr</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="k">save</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">minerr</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">iord</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                  save</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pdelta</span><span class="w"></span>
<span class="w">                  </span><span class="k">save</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">deltaf</span><span class="w"></span>
<span class="w">                  </span><span class="k">save</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pmaxf</span><span class="w"></span>
<span class="w">                  </span><span class="k">save</span><span class="p">(</span><span class="mi">13</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">maxfun</span><span class="w"></span>
<span class="w">                </span><span class="k">else if</span><span class="w"> </span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">iord</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                  save</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f2</span><span class="w"></span>
<span class="w">                  </span><span class="k">save</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f3</span><span class="w"></span>
<span class="w">                  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">iord</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="k">save</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f4</span><span class="w"></span>
<span class="w">                </span><span class="k">end if</span>
<span class="k">                </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="o">*</span><span class="n">baseh</span><span class="w"></span>
<span class="w">                </span><span class="n">heval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">h</span><span class="w"></span>
<span class="w">                </span><span class="n">baseh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">h</span><span class="w"></span>
<span class="w">                </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="w">              </span><span class="k">else</span>
<span class="k">                </span><span class="n">init</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">                </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">beta</span><span class="o">*</span><span class="n">h</span><span class="w"></span>
<span class="w">                </span><span class="n">heval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">beta</span><span class="o">*</span><span class="n">heval</span><span class="w"></span>
<span class="w">              </span><span class="k">end if</span>
<span class="k">            else if</span><span class="w"> </span><span class="p">(</span><span class="n">contin</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">beta</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">heval</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">maxh</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">              </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">beta</span><span class="o">*</span><span class="n">h</span><span class="w"></span>
<span class="w">              </span><span class="n">heval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">beta</span><span class="o">*</span><span class="n">heval</span><span class="w"></span>
<span class="w">            </span><span class="k">else if</span><span class="w"> </span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">              </span><span class="n">contin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<span class="w">              </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                </span><span class="n">init</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="w"></span>
<span class="w">                </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">iord</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                  if</span><span class="w"> </span><span class="p">(</span><span class="n">x0</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mf">0.0_wp</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                    </span><span class="n">dummy1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0_wp</span><span class="w"></span>
<span class="w">                    </span><span class="n">dummy2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">h0</span><span class="w"></span>
<span class="w">                    </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">faccur</span><span class="p">(</span><span class="n">dummy1</span><span class="p">,</span><span class="n">dummy2</span><span class="p">,</span><span class="n">acc0</span><span class="p">,</span><span class="n">x0</span><span class="p">,</span><span class="n">twoinf</span><span class="p">,</span><span class="n">f0</span><span class="p">,</span><span class="n">f1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">else</span>
<span class="k">                    </span><span class="n">acc0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0_wp</span><span class="w"></span>
<span class="w">                  </span><span class="k">end if</span>
<span class="k">                end if</span>
<span class="k">              else</span>
<span class="k">                </span><span class="n">init</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="w">                </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">              </span><span class="k">end if</span>
<span class="k">              </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="w">              </span><span class="n">signh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">signh</span><span class="w"></span>
<span class="w">            </span><span class="k">else</span>
<span class="k">              </span><span class="n">contin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<span class="w">            </span><span class="k">end if</span>

<span class="k">        end do</span>

<span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="n">eps</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.0_wp</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">          </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="n">eps</span><span class="o">*</span><span class="n">deriv</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="k">else</span>
<span class="k">          </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eps</span><span class="w"></span>
<span class="w">        </span><span class="k">end if</span>
<span class="k">        </span><span class="n">ifail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">eps</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mf">0.0_wp</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="n">ifail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>

<span class="w">    </span><span class="k">end if</span>

<span class="k">    end subroutine </span><span class="n">diff</span><span class="w"></span>
</pre></div>

    </section>
    <br>
    
    </div>
  </div>

    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-6"><p>diff was developed by Jacob Williams<br>&copy; 2022 
</p>
        </div>
        <div class="col-xs-6 col-md-6">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/Fortran-FOSS-Programmers/ford">FORD</a>
          </p>
        </div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
  </body>
</html>